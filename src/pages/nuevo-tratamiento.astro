---
import LayoutCommon from "../app/LayoutCommon.astro";
const BASE_URL = 'http://localhost:5000/api/tratamientos';
---

<LayoutCommon>
  <div class="min-h-screen bg-gradient-to-r from-slate-100 to-slate-200 p-4 text-slate-800 dark:from-slate-900 dark:to-slate-800 dark:text-slate-100 lg:p-16">
    <div class="mx-auto max-w-4xl">
      <div class="mb-8">
        <a href="/tratamiento" class="text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300">← Volver a tratamientos</a>
      </div>

      <div class="rounded-lg bg-white p-6 shadow-xl dark:bg-gray-800">
        <h1 class="mb-6 text-2xl font-bold">Nuevo Tratamiento</h1>
        
        <form id="nuevoTratamientoForm" class="space-y-6">
          <div class="space-y-4">
            <div>
              <label for="nombre" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nombre</label>
              <input type="text" id="nombre" name="nombre" required class="mt-1 w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
            </div>

            <div>
              <label for="descripcion" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Descripción</label>
              <textarea id="descripcion" name="descripcion" rows="4" required class="mt-1 w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"></textarea>
            </div>
          </div>

          <div class="flex justify-end space-x-4">
            <button type="reset" class="rounded-lg px-4 py-2 text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">Cancelar</button>
            <button type="submit" class="rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-300">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</LayoutCommon>

<script define:vars={{ BASE_URL }}>
  const form = document.getElementById('nuevoTratamientoForm');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const nombre = document.getElementById('nombre').value.trim();
    const descripcion = document.getElementById('descripcion').value.trim();

    if (nombre.length < 3 || descripcion.length < 10) {
      alert('El nombre debe tener al menos 3 caracteres y la descripción al menos 10.');
      return;
    }

    const response = await fetch(`${BASE_URL}/create`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ nombre, descripcion })
    });

    if (response.ok) {
      window.location.href = '/tratamiento';
    } else {
      alert('Error al crear el tratamiento');
    }
  });
</script>
