import{s as m,a as g}from"./middleware.Bh-cDEu3.js";const l=document.getElementById("loginForm"),d=document.getElementById("email"),u=document.getElementById("password"),i=document.getElementById("submitBtn"),c=document.getElementById("loadingSpinner"),n=document.getElementById("errorMessage"),p=async(t,e)=>{try{const o=await fetch("https://consultorio-odontologico-backend-production-b1c8.up.railway.app/api//login/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e})});if(!o.ok)throw new Error("Error al iniciar sesión. Verifica tus credenciales.");const s=await o.json();if(console.log("Respuesta del login:",s),s.success){let a;if(s.rol==="odontologo"){a=await fetch(`https://consultorio-odontologico-backend-production-b1c8.up.railway.app/api//medico/findByEmail/${t}`);const r=await a.json();if(r.medico)return{success:!0,message:s.message,rol:s.rol,userId:r.medico._id}}else if(s.rol==="secretaria"){a=await fetch(`https://consultorio-odontologico-backend-production-b1c8.up.railway.app/api//secretaria/buscar/${t}`);const r=await a.json();if(r.secretaria)return{success:!0,message:s.message,rol:s.rol,userId:r.secretaria._id}}return{success:!1,message:`No se encontró el perfil de ${s.rol}`,userId:"",rol:""}}return{success:!1,message:"No se pudo verificar la identidad del usuario",userId:"",rol:""}}catch(o){return console.error("Error en validateUser:",o),{success:!1,message:o instanceof Error?o.message:"Error en la autenticación",userId:"",rol:""}}};l&&d&&u&&i&&c&&n&&l.addEventListener("submit",async t=>{t.preventDefault(),i.disabled=!0,c.classList.remove("hidden"),n.classList.add("hidden");const e=await p(d.value,u.value);console.log("Respuesta completa:",e),e.success&&e.userId?(console.log("Setting user role:",e.rol),console.log("Setting user ID:",e.userId),m(e.rol),g(e.userId),setTimeout(()=>{window.location.href="/"},100)):(n.textContent=e.message,n.classList.remove("hidden")),i.disabled=!1,c.classList.add("hidden")});
