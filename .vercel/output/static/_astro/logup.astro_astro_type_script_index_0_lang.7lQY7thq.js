const p=document.getElementById("signupForm"),i=document.getElementById("rol"),b=document.getElementById("camposMedico"),f=document.getElementById("camposSecretaria"),c=document.getElementById("submitBtn");document.getElementById("loadingSpinner");const E=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),h=t=>/^\d{6,14}$/.test(t),y=t=>/^[a-zA-ZÀ-ÿ\s]{3,40}$/.test(t),m=(t,e)=>{const o=t.nextElementSibling?.classList.contains("error-message")?t.nextElementSibling:document.createElement("div");t.nextElementSibling?.classList.contains("error-message")||(o.classList.add("error-message","text-sm","text-red-500","mt-1"),t.parentNode.insertBefore(o,t.nextSibling)),o.textContent=e,o.style.display=e?"block":"none",e?(t.classList.remove("border-gray-300","focus:border-blue-500"),t.classList.add("border-red-500","focus:border-red-500")):(t.classList.remove("border-red-500","focus:border-red-500"),t.classList.add("border-gray-300","focus:border-blue-500"))},n=t=>{if(t.disabled)return!0;const e=t.value.trim();let o="";if(!e)o="Este campo es obligatorio";else switch(t.name){case"email":E(e)||(o="Email inválido");break;case"password":e.length<6&&(o="La contraseña debe tener al menos 6 caracteres");break;case"nombre":y(e)||(o="Solo se permiten letras y espacios (3-40 caracteres)");break;case"celular":h(e)||(o="El celular debe tener entre 6 y 14 dígitos");break}return m(t,o),!o};i.addEventListener("change",()=>{const t=i.value;b.classList.toggle("hidden",t!=="odontologo"),f.classList.toggle("hidden",t!=="secretaria"),t==="odontologo"?(document.querySelectorAll("#camposSecretaria input").forEach(e=>{e.disabled=!0,m(e,"")}),document.querySelectorAll("#camposMedico input").forEach(e=>{e.disabled=!1})):t==="secretaria"&&(document.querySelectorAll("#camposMedico input").forEach(e=>{e.disabled=!0,m(e,"")}),document.querySelectorAll("#camposSecretaria input").forEach(e=>{e.disabled=!1})),u()});const u=()=>{const t=i.value;if(!t)return c.disabled=!0,!1;let e=!0;return e=n(document.getElementById("password"))&&e,t==="odontologo"?["nombreMedico","especialidad","celularMedico","nMatricula"].forEach(s=>{const r=document.getElementById(s);r.disabled||(e=n(r)&&e)}):t==="secretaria"&&["nombreSecretaria","celularSecretaria"].forEach(s=>{const r=document.getElementById(s);r.disabled||(e=n(r)&&e)}),c.disabled=!e,e};p.querySelectorAll("input").forEach(t=>{["input","blur"].forEach(e=>{t.addEventListener(e,()=>{t.disabled||(n(t),u())})})});p.addEventListener("submit",async t=>{if(t.preventDefault(),!u())return;c.innerHTML=`
    <div class="flex justify-center items-center">
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Creando cuenta...
    </div>
  `,c.disabled=!0;const e=i.value;try{const o=document.getElementById("email").value,s=document.getElementById("password").value,r={email:o.toLowerCase(),password:s,rol:e};console.log("Enviando datos de usuario:",r);const g=await fetch("https://consultorio-odontologico-backend-production-b1c8.up.railway.app/api//login/registro",{method:"POST",headers:{"Content-Type":"application/json",Origin:"http://localhost:4321"},body:JSON.stringify(r)});if(!g.ok){const a=await g.json();throw new Error(a.message||"Error al crear usuario")}if(e==="secretaria"){const a={nombre:document.getElementById("nombreSecretaria").value.toLowerCase(),email:o.toLowerCase(),celular:document.getElementById("celularSecretaria").value.replace(/\D/g,"")};console.log("Enviando datos de secretaria:",a);const l=await fetch("https://consultorio-odontologico-backend-production-b1c8.up.railway.app/api//secretaria/create",{method:"POST",headers:{"Content-Type":"application/json",Origin:"http://localhost:4321"},body:JSON.stringify(a)});if(!l.ok){const d=await l.json();throw new Error(d.message||"Error al crear perfil de secretaria")}}else if(e==="odontologo"){const a={nombre:document.getElementById("nombreMedico").value.toLowerCase(),email:o.toLowerCase(),especialidad:document.getElementById("especialidad").value,celular:document.getElementById("celularMedico").value.replace(/\D/g,""),nMatricula:document.getElementById("nMatricula").value,clave:s};console.log("Enviando datos de médico:",a);const l=await fetch("https://consultorio-odontologico-backend-production-b1c8.up.railway.app/api//medico/create",{method:"POST",headers:{"Content-Type":"application/json",Origin:"http://localhost:4321"},body:JSON.stringify(a)});if(!l.ok){const d=await l.json();throw new Error(d.message||"Error al crear perfil de médico")}}alert("Cuenta creada exitosamente"),window.location.href="/login"}catch(o){console.error("Error:",o),alert(o.message||"Error en el registro"),c.disabled=!1,c.innerHTML="Crear cuenta"}});
